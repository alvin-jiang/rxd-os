/**
 *
 * @file: keyboard.c
 * @author: Alvin Jiang
 * @mail: celsius.j@gmail.com
 * @created time: 2015-04-14
 *
 */

#include "keyboard.h"

#include "assert.h"

int kb_keycode (int scan_code) {
    static const int keycode[NR_KEYS] = {
/* 0x00 - none      */  0,
/* 0x01 - ESC       */  KEY_ESC,
/* 0x02 - '1'       */  KEY_1,
/* 0x03 - '2'       */  KEY_2,
/* 0x04 - '3'       */  KEY_3,
/* 0x05 - '4'       */  KEY_4,
/* 0x06 - '5'       */  KEY_5,
/* 0x07 - '6'       */  KEY_6,
/* 0x08 - '7'       */  KEY_7,
/* 0x09 - '8'       */  KEY_8,
/* 0x0A - '9'       */  KEY_9,
/* 0x0B - '0'       */  KEY_0,
/* 0x0C - '-'       */  KEY_MINUS,
/* 0x0D - '='       */  KEY_EQUALS,
/* 0x0E - BACKSPACE */  KEY_BACKSLASH,
/* 0x0F - TAB       */  KEY_TAB,
/* 0x10 - 'q'       */  KEY_Q,
/* 0x11 - 'w'       */  KEY_W,
/* 0x12 - 'e'       */  KEY_E,
/* 0x13 - 'r'       */  KEY_R,
/* 0x14 - 't'       */  KEY_T,
/* 0x15 - 'y'       */  KEY_Y,
/* 0x16 - 'u'       */  KEY_U,
/* 0x17 - 'i'       */  KEY_I,
/* 0x18 - 'o'       */  KEY_O,
/* 0x19 - 'p'       */  KEY_P,
/* 0x1A - '['       */  KEY_LEFT_BRACKET,
/* 0x1B - ']'       */  KEY_RIGHT_BRACKET,
/* 0x1C - RETURN    */  KEY_ENTER,
/* 0x1D - CTRL_L    */  KEY_CTRL_L,
/* 0x1E - 'a'       */  KEY_A,
/* 0x1F - 's'       */  KEY_S,
/* 0x20 - 'd'       */  KEY_D,
/* 0x21 - 'f'       */  KEY_F,
/* 0x22 - 'g'       */  KEY_G,
/* 0x23 - 'h'       */  KEY_H,
/* 0x24 - 'j'       */  KEY_J,
/* 0x25 - 'k'       */  KEY_K,
/* 0x26 - 'l'       */  KEY_L,
/* 0x27 - ';'       */  KEY_SEMICOLON,
/* 0x28 - '\''      */  KEY_SINGLE_QUOTE,
/* 0x29 - '`'       */  KEY_GRAVE,
/* 0x2A - SHIFT_L   */  KEY_SHIFT_L,
/* 0x2B - '\'       */  KEY_BACKSLASH,
/* 0x2C - 'z'       */  KEY_Z,
/* 0x2D - 'x'       */  KEY_X,
/* 0x2E - 'c'       */  KEY_C,
/* 0x2F - 'v'       */  KEY_V,
/* 0x30 - 'b'       */  KEY_B,
/* 0x31 - 'n'       */  KEY_N,
/* 0x32 - 'm'       */  KEY_M,
/* 0x33 - ','       */  KEY_COMMA,
/* 0x34 - '.'       */  KEY_PERIOD,
/* 0x35 - '/'       */  KEY_SLASH,
/* 0x36 - SHIFT_R   */  0,
/* 0x37 - '*'       */  0,
/* 0x38 - ALT       */  KEY_ALT_L,
/* 0x39 - ' '       */  KEY_SPACE,
/* 0x3A - CapsLock  */  KEY_CAPS_LOCK,
/* 0x3B - F1        */  KEY_F1,
/* 0x3C - F2        */  KEY_F2,
/* 0x3D - F3        */  KEY_F3,
/* 0x3E - F4        */  KEY_F4,
/* 0x3F - F5        */  KEY_F5,
/* 0x40 - F6        */  KEY_F6,
/* 0x41 - F7        */  KEY_F7,
/* 0x42 - F8        */  KEY_F8,
/* 0x43 - F9        */  KEY_F9,
/* 0x44 - F10       */  KEY_F10,
/* 0x45 - NumLock   */  KEY_NUM_LOCK,
/* 0x46 - ScrLock   */  0,         /* scroll lock */
/* 0x47 - Home      */  0,
/* 0x48 - CurUp     */  0,
/* 0x49 - PgUp      */  0,
/* 0x4A - '-'       */  0,
/* 0x4B - Left      */  0,
/* 0x4C - MID       */  0,
/* 0x4D - Right     */  0,
/* 0x4E - '+'       */  0,
/* 0x4F - End       */  0,
/* 0x50 - Down      */  0,
/* 0x51 - PgDown    */  0,
/* 0x52 - Insert    */  0,
/* 0x53 - Delete    */  0,
/* 0x54 - Enter     */  0,
/* 0x55 - ???       */  0,
/* 0x56 - ???       */  0,
/* 0x57 - F11       */  KEY_F11,
/* 0x58 - F12       */  KEY_F12,
    };
    scan_code &= ~(0x80);
    assert( scan_code >= 0 &&
        scan_code < (sizeof(keycode)/sizeof(int)) );
    return keycode[scan_code];
}
// scan code -> ascii
unsigned char kb_ascii (int scan_code, int kb_flag) {
    static const unsigned char ascii[NR_KEYS * 2] = {
/* 0x00 - none      */  0,0,
/* 0x01 - ESC       */  0x27,   0x27,
/* 0x02 - '1'       */  '1',    '!',
/* 0x03 - '2'       */  '2',    '@',
/* 0x04 - '3'       */  '3',    '#',
/* 0x05 - '4'       */  '4',    '$',
/* 0x06 - '5'       */  '5',    '%',
/* 0x07 - '6'       */  '6',    '^',
/* 0x08 - '7'       */  '7',    '&',
/* 0x09 - '8'       */  '8',    '*',
/* 0x0A - '9'       */  '9',    '(',
/* 0x0B - '0'       */  '0',    ')',
/* 0x0C - '-'       */  '-',    '_',
/* 0x0D - '='       */  '=',    '+',
/* 0x0E - BACKSPACE */  '\b',   '\b',
/* 0x0F - TAB       */  '\t',   '\t',
/* 0x10 - 'q'       */  'q',    'Q',
/* 0x11 - 'w'       */  'w',    'W',
/* 0x12 - 'e'       */  'e',    'E',
/* 0x13 - 'r'       */  'r',    'R',
/* 0x14 - 't'       */  't',    'T',
/* 0x15 - 'y'       */  'y',    'Y',
/* 0x16 - 'u'       */  'u',    'U',
/* 0x17 - 'i'       */  'i',    'I',
/* 0x18 - 'o'       */  'o',    'O',
/* 0x19 - 'p'       */  'p',    'P',
/* 0x1A - '['       */  '[',    '{',
/* 0x1B - ']'       */  ']',    '}',
/* 0x1C - RETURN    */  0,0,
/* 0x1D - CTRL_L    */  0,0,
/* 0x1E - 'a'       */  'a',    'A',
/* 0x1F - 's'       */  's',    'S',
/* 0x20 - 'd'       */  'd',    'D',
/* 0x21 - 'f'       */  'f',    'F',
/* 0x22 - 'g'       */  'g',    'G',
/* 0x23 - 'h'       */  'h',    'H',
/* 0x24 - 'j'       */  'j',    'J',
/* 0x25 - 'k'       */  'k',    'K',
/* 0x26 - 'l'       */  'l',    'L',
/* 0x27 - ';'       */  ';',    ':',
/* 0x28 - '\''      */  '\'',   '"',
/* 0x29 - '`'       */  '`',    '~',
/* 0x2A - SHIFT_L   */  0,0,
/* 0x2B - '\'       */  '\\',   '|',
/* 0x2C - 'z'       */  'z',    'Z',
/* 0x2D - 'x'       */  'x',    'X',
/* 0x2E - 'c'       */  'c',    'C',
/* 0x2F - 'v'       */  'v',    'V',
/* 0x30 - 'b'       */  'b',    'B',
/* 0x31 - 'n'       */  'n',    'N',
/* 0x32 - 'm'       */  'm',    'M',
/* 0x33 - ','       */  ',',    '<',
/* 0x34 - '.'       */  '.',    '>',
/* 0x35 - '/'       */  '/',    '?',
/* 0x36 - SHIFT_R   */  0,0,
/* 0x37 - '*'       */  '*',    '*',
/* 0x38 - ALT       */  0,0,
/* 0x39 - ' '       */  ' ',    ' ',
/* 0x3A - CapsLock  */  0,0,
/* 0x3B - F1        */  0,0,
/* 0x3C - F2        */  0,0,
/* 0x3D - F3        */  0,0,
/* 0x3E - F4        */  0,0,
/* 0x3F - F5        */  0,0,
/* 0x40 - F6        */  0,0,
/* 0x41 - F7        */  0,0,
/* 0x42 - F8        */  0,0,
/* 0x43 - F9        */  0,0,
/* 0x44 - F10       */  0,0,
/* 0x45 - NumLock   */  0,0,
/* 0x46 - ScrLock   */  0,0,
/* 0x47 - Home      */  0,0,
/* 0x48 - CurUp     */  0,0,
/* 0x49 - PgUp      */  0,0,
/* 0x4A - '-'       */  0,0,
/* 0x4B - Left      */  0,0,
/* 0x4C - MID       */  0,0,
/* 0x4D - Right     */  0,0,
/* 0x4E - '+'       */  0,0,
/* 0x4F - End       */  0,0,
/* 0x50 - Down      */  0,0,
/* 0x51 - PgDown    */  0,0,
/* 0x52 - Insert    */  0,0,
/* 0x53 - Delete    */  0,0,
/* 0x54 - Enter     */  0,0,
/* 0x55 - ???       */  0,0,
/* 0x56 - ???       */  0,0,
/* 0x57 - F11       */  0,0,
/* 0x58 - F12       */  0,0,
    };
    assert( scan_code >= 0 &&
        scan_code < (sizeof(ascii)/sizeof(unsigned char)) );
    return ascii[scan_code * 2 + ((kb_flag & KB_F_SHIFT) ? 1 : 0)];
}

// /*  normal      shift       E0  */
//         0,          0,          0,  /* 0x00 - none      */
//         0,          0,          0,  /* 0x01 - ESC       */
//         '1',        '!',        0,  /* 0x02 - '1'       */
//         '2',        '@',        0,  /* 0x03 - '2'       */
//         '3',        '#',        0,  /* 0x04 - '3'       */
//         '4',        '$',        0,  /* 0x05 - '4'       */
//         '5',        '%',        0,  /* 0x06 - '5'       */
//         '6',        '^',        0,  /* 0x07 - '6'       */
//         '7',        '&',        0,  /* 0x08 - '7'       */
//         '8',        '*',        0,  /* 0x09 - '8'       */
//         '9',        '(',        0,  /* 0x0A - '9'       */
//         '0',        ')',        0,  /* 0x0B - '0'       */
//         '-',        '_',        0,  /* 0x0C - '-'       */
//         '=',        '+',        0,  /* 0x0D - '='       */
//         0,          0,          0,  /* 0x0E - BACKSPACE */
//         0,          0,          0,  /* 0x0F - TAB       */
//         'q',        'Q',        0,  /* 0x10 - 'q'       */
//         'w',        'W',        0,  /* 0x11 - 'w'       */
//         'e',        'E',        0,  /* 0x12 - 'e'       */
//         'r',        'R',        0,  /* 0x13 - 'r'       */
//         't',        'T',        0,  /* 0x14 - 't'       */
//         'y',        'Y',        0,  /* 0x15 - 'y'       */
//         'u',        'U',        0,  /* 0x16 - 'u'       */
//         'i',        'I',        0,  /* 0x17 - 'i'       */
//         'o',        'O',        0,  /* 0x18 - 'o'       */
//         'p',        'P',        0,  /* 0x19 - 'p'       */
//         '[',        '{',        0,  /* 0x1A - '['       */
//         ']',        '}',        0,  /* 0x1B - ']'       */
//         ENTER,      ENTER,      PAD_ENTER,  /* 0x1C - CR/LF     */
//         CTRL_L,     CTRL_L,     CTRL_R, /* 0x1D - l. Ctrl   */
//         'a',        'A',        0,  /* 0x1E - 'a'       */
//         's',        'S',        0,  /* 0x1F - 's'       */
//         'd',        'D',        0,  /* 0x20 - 'd'       */
//         'f',        'F',        0,  /* 0x21 - 'f'       */
//         'g',        'G',        0,  /* 0x22 - 'g'       */
//         'h',        'H',        0,  /* 0x23 - 'h'       */
//         'j',        'J',        0,  /* 0x24 - 'j'       */
//         'k',        'K',        0,  /* 0x25 - 'k'       */
//         'l',        'L',        0,  /* 0x26 - 'l'       */
//         ';',        ':',        0,  /* 0x27 - ';'       */
//         '\'',       '"',        0,  /* 0x28 - '\''      */
//         '`',        '~',        0,  /* 0x29 - '`'       */
//         SHIFT_L,    SHIFT_L,    0,  /* 0x2A - l. SHIFT  */
//         '\\',       '|',        0,  /* 0x2B - '\'       */
//         'z',        'Z',        0,  /* 0x2C - 'z'       */
//         'x',        'X',        0,  /* 0x2D - 'x'       */
//         'c',        'C',        0,  /* 0x2E - 'c'       */
//         'v',        'V',        0,  /* 0x2F - 'v'       */
//         'b',        'B',        0,  /* 0x30 - 'b'       */
//         'n',        'N',        0,  /* 0x31 - 'n'       */
//         'm',        'M',        0,  /* 0x32 - 'm'       */
//         ',',        '<',        0,  /* 0x33 - ','       */
//         '.',        '>',        0,  /* 0x34 - '.'       */
//         '/',        '?',        PAD_SLASH,  /* 0x35 - '/'       */
//         SHIFT_R,    SHIFT_R,    0,  /* 0x36 - r. SHIFT  */
//         '*',        '*',        0,  /* 0x37 - '*'       */
//         ALT_L,      ALT_L,      ALT_R,  /* 0x38 - ALT       */
//         ' ',        ' ',        0,  /* 0x39 - ' '       */
//         CAPS_LOCK,  CAPS_LOCK,  0,  /* 0x3A - CapsLock  */
//         F1,     F1,     0,  /* 0x3B - F1        */
//         F2,     F2,     0,  /* 0x3C - F2        */
//         F3,     F3,     0,  /* 0x3D - F3        */
//         F4,     F4,     0,  /* 0x3E - F4        */
//         F5,     F5,     0,  /* 0x3F - F5        */
//         F6,     F6,     0,  /* 0x40 - F6        */
//         F7,     F7,     0,  /* 0x41 - F7        */
//         F8,     F8,     0,  /* 0x42 - F8        */
//         F9,     F9,     0,  /* 0x43 - F9        */
//         F10,        F10,        0,  /* 0x44 - F10       */
//         NUM_LOCK,   NUM_LOCK,   0,  /* 0x45 - NumLock   */
//         SCROLL_LOCK,    SCROLL_LOCK,    0,  /* 0x46 - ScrLock   */
//         PAD_HOME,   '7',        HOME,   /* 0x47 - Home      */
//         PAD_UP,     '8',        UP, /* 0x48 - CurUp     */
//         PAD_PAGEUP, '9',        PAGEUP, /* 0x49 - PgUp      */
//         PAD_MINUS,  '-',        0,  /* 0x4A - '-'       */
//         PAD_LEFT,   '4',        LEFT,   /* 0x4B - Left      */
//         PAD_MID,    '5',        0,  /* 0x4C - MID       */
//         PAD_RIGHT,  '6',        RIGHT,  /* 0x4D - Right     */
//         PAD_PLUS,   '+',        0,  /* 0x4E - '+'       */
//         PAD_END,    '1',        END,    /* 0x4F - End       */
//         PAD_DOWN,   '2',        DOWN,   /* 0x50 - Down      */
//         PAD_PAGEDOWN,   '3',        PAGEDOWN,   /* 0x51 - PgDown    */
//         PAD_INS,    '0',        INSERT, /* 0x52 - Insert    */
//         PAD_DOT,    '.',        DELETE, /* 0x53 - Delete    */
//         0,      0,      0,  /* 0x54 - Enter     */
//         0,      0,      0,  /* 0x55 - ???       */
//         0,      0,      0,  /* 0x56 - ???       */
//         F11,        F11,        0,      /* 0x57 - F11       */
//         F12,        F12,        0,      /* 0x58 - F12       */
//         0,      0,      0,      /* 0x59 - ???       */
//         0,      0,      0,      /* 0x5A - ???       */
//         0,      0,      GUI_L,      /* 0x5B - ???       */
//            0,      GUI_R,   0x5C - ???         0,
//         0,      0,      APPS,       /* 0x5D - ???       */
//         0,      0,      0,      /* 0x5E - ???       */
//         0,      0,      0,  /* 0x5F - ???       */
//         0,      0,      0,  /* 0x60 - ???       */
//         0,      0,      0,      /* 0x61 - ???       */
//         0,      0,      0,      /* 0x62 - ???       */
//         0,      0,      0,      /* 0x63 - ???       */
//         0,      0,      0,      /* 0x64 - ???       */
//         0,      0,      0,      /* 0x65 - ???       */
//         0,      0,      0,      /* 0x66 - ???       */
//         0,      0,      0,      /* 0x67 - ???       */
//         0,      0,      0,      /* 0x68 - ???       */
//         0,      0,      0,      /* 0x69 - ???       */
//         0,      0,      0,      /* 0x6A - ???       */
//         0,      0,      0,      /* 0x6B - ???       */
//         0,      0,      0,      /* 0x6C - ???       */
//         0,      0,      0,      /* 0x6D - ???       */
//         0,      0,      0,      /* 0x6E - ???       */
//         0,      0,      0,      /* 0x6F - ???       */
//         0,      0,      0,      /* 0x70 - ???       */
//         0,      0,      0,      /* 0x71 - ???       */
//         0,      0,      0,      /* 0x72 - ???       */
//         0,      0,      0,      /* 0x73 - ???       */
//         0,      0,      0,      /* 0x74 - ???       */
//         0,      0,      0,      /* 0x75 - ???       */
//         0,      0,      0,      /* 0x76 - ???       */
//         0,      0,      0,      /* 0x77 - ???       */
//         0,      0,      0,      /* 0x78 - ???       */
//         0,      0,      0,      /* 0x78 - ???       */
//         0,      0,      0,      /* 0x7A - ???       */
//         0,      0,      0,      /* 0x7B - ???       */
//         0,      0,      0,      /* 0x7C - ???       */
//         0,      0,      0,      /* 0x7D - ???       */
//         0,      0,      0,  /* 0x7E - ???       */
//         0,      0,      0   /* 0x7F - ???       */
